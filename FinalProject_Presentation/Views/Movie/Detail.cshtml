@model Movie

<!--<< Breadcrumb Section Start >>-->
<div class="breadcrumb-wrapper bg-cover" style="background-image: url('assets/img/breadcrumb-bg.jpg');">
    <div class="container">
        <div class="page-heading">
            <div class="page-header-left">
                <h1 class="wow fadeInUp" data-wow-delay=".3s">Movie Details</h1>
                <ul class="breadcrumb-items wow fadeInUp" data-wow-delay=".5s">
                    <li>
                        <a href="index.html">
                            <i class="fa-solid fa-house"></i>
                            Home
                        </a>
                    </li>
                    <li>
                        <i class="fa-solid fa-slash-forward"></i>
                    </li>
                    <li>
                        Movie Details
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!--<< Movie Details Section Start >>-->
<section class="movie-details-section section-padding pb-0">
    <div class="container-fluid">
        <div class="movie-details-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <div class="movie-details-image">
                        <img src="@Model.Image " alt="img">
                        <a data-fancybox data-src="@Model.Video" class="video-btn ripple video-popup" href="javascript:;">
                            <i class="fa-solid fa-play"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xl-8">
                    <div class="movie-details-content">
                        <div class="description-content">
                            <h3>Description</h3>
                            <span>@Model.Description</span>
                            <ul class="description-list">
                                <li>@Model.Year</li>
                                <li>By @Model.Directors.FullName</li>
                                <li>@($"{(Model.Duration / 60)}h {(Model.Duration % 60)}min")</li>
                                <li>
                                    <span class="star">
                                        <i class="fa-solid fa-star"></i>
                                        <i class="fa-solid fa-star"></i>
                                        <i class="fa-solid fa-star"></i>
                                        <i class="fa-solid fa-star"></i>
                                        <i class="fa-solid fa-star color-2"></i>
                                    </span>
                                </li>
                            </ul>
                            <p>A fiery young man clashes with an unflinching forest officer in a south Indian village where spirituality, fate and folklore rule the lands.</p>
                        </div>
                        <div class="description-content cost-items">
                            <div class="section-title-area">
                                <div class="section-title">
                                    <h3>Cast</h3>
                                </div>
                                <div class="array-button-2">
                                    <button class="cta-prev"><i class="fa-solid fa-chevron-left"></i></button>
                                    <button class="cta-next"><i class="fa-solid fa-chevron-right"></i></button>
                                </div>
                            </div>
                            <div class="swiper cast-slider">
                                <div class="swiper-wrapper">
                                    @foreach (var actor in Model.MovieActors)
                                    {
                                        <div class="swiper-slide">
                                            <div class="cast-image">
                                                <img src="@actor.Actor.Image" alt="img">
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="description-content review-items">
                            <div class="section-title-area">
                                <div class="section-title">
                                    <h3>Reviews</h3>
                                </div>
                                <a href="javascript:void(0)" id="openModalBtn" class="theme-btn"><i class="fa-solid fa-plus"></i> Add Your Review</a>

                                <!-- Modal -->
                                <div id="myModal" class="Mymodal">
                                    <div class="Mymodal-content">
                                        <span id="closeModalBtn" class="Myclose-btn">&times;</span>
                                        <h4 class="myReviw">Write a Review</h4>
                                        <div class="reviews-container">
                                            <form method="post" action="/Movie/AddComment" class="review-form" id="reviewForm">
                                                <input type="hidden" name="MovieId" value="@Model.Id" />
                                                <textarea id="commentText" placeholder="Write your comment here..."></textarea>
                                                <button id="saveCommentBtn" class="submit-btn">Submit</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>

                                <style>
                                    /* Modal Styles */
                                    .Mymodal {
                                        display: none;
                                        position: fixed;
                                        z-index: 1;
                                        left: 0;
                                        top: 0;
                                        width: 100%;
                                        height: 100%;
                                        overflow: auto;
                                        background-color: rgba(0, 0, 0, 0.7);
                                    }

                                    .Mymodal-content {
                                        background-color: #1d1d1d;
                                        color: white;
                                        border-radius: 10px;
                                        margin: 10% auto;
                                        padding: 30px;
                                        max-width: 500px;
                                        position: relative;
                                    }

                                    .Myclose-btn {
                                        position: absolute;
                                        top: 10px;
                                        right: 20px;
                                        color: white;
                                        font-size: 30px;
                                        cursor: pointer;
                                    }

                                        .Myclose-btn:hover {
                                            color: #e63946;
                                        }

                                    .myReviw {
                                        text-align: center;
                                        margin-bottom: 20px;
                                    }

                                    /* Reviews Container */
                                    .reviews-container {
                                        background: #1d1d1d;
                                        padding: 20px;
                                        border-radius: 10px;
                                        max-width: 600px;
                                        margin: auto;
                                        text-align: center;
                                    }

                                    /* Textarea */
                                    .review-form textarea {
                                        width: 100%;
                                        height: 150px;
                                        padding: 10px;
                                        margin-bottom: 20px;
                                        border-radius: 8px;
                                        border: none;
                                        resize: none;
                                        font-size: 16px;
                                        background: #2b2b2b;
                                        color: white;
                                    }

                                        .review-form textarea:focus {
                                            outline: none;
                                            border: 1px solid #e63946;
                                        }

                                    /* Submit Button */
                                    .review-form button {
                                        background: #e63946;
                                        border: none;
                                        padding: 10px 20px;
                                        color: white;
                                        cursor: pointer;
                                        font-weight: bold;
                                        border-radius: 8px;
                                        width: 100%;
                                    }

                                        .review-form button:hover {
                                            background: #d62839;
                                        }

                                </style>

                                <script>
                                    const modal = document.getElementById('myModal');
                                    const openBtn = document.getElementById('openModalBtn');
                                    const closeBtn = document.getElementById('closeModalBtn');
                                    const saveBtn = document.getElementById('saveCommentBtn');

                                    openBtn.onclick = () => {
                                        modal.style.display = 'flex';
                                    };

                                    closeBtn.onclick = () => {
                                        modal.style.display = 'none';
                                    };

                                    saveBtn.onclick = async (event) => {
                                        event.preventDefault();

                                        const comment = document.getElementById('commentText').value;
                                        const movieId = @Model.Id;

                                        if (!comment.trim()) {
                                            alert('Please write a comment.');
                                            return;
                                        }

                                        const data = {
                                            Text: comment,
                                            MovieId: movieId
                                        };

                                        try {
                                            const response = await fetch('/Movie/AddComment', {
                                                method: 'POST',
                                                headers: {
                                                    'Content-Type': 'application/json'
                                                },
                                                body: JSON.stringify(data)
                                            });

                                            if (response.ok) {
                                                alert('Comment added successfully!');
                                                modal.style.display = 'none';
                                                location.reload();
                                            } else if (response.status === 401) {
                                                alert('You must be logged in as a member to comment.');
                                                window.location.href = '/Account/Login';
                                            } else {
                                                alert('Failed to add comment.');
                                            }
                                        } catch (error) {
                                            console.error('Error submitting comment:', error);
                                            alert('An unexpected error occurred.');
                                        }
                                    };
                                </script>
                            </div>
                            <div class="swiper review-slider">
                                <div class="swiper-wrapper">
                                    @foreach (var comment in Model.MovieComments)
                                    {
                                        <div class="swiper-slide">
                                            <div class="review-box-items">
                                                <div class="client-info-items">
                                                    <div class="client-content">
                                                        <h4>@comment.AppUser.FullName</h4>
                                                    </div>
                                                    <div class="star">
                                                        @for (int i = 0; i < 5; i++)
                                                        {
                                                            <span class="fa-solid @(i<comment.Rate?"fa-star":"fa-star-half-stroke")"></span>
                                                        }
                                                        @comment.Rate
                                                    </div>
                                                </div>
                                                <p>
                                                    @comment.Text
                                                </p>
                                                @if (User.Identity.Name == comment.AppUser.UserName)
                                                {
                                                    <a class="btn btn-danger" asp-action="deleteComment" asp-route-id="@comment.Id">delete</a>
                                                }
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                            <div class="array-button-2 justify-content-center pt-5">
                                <button class="array-prev"><i class="fa-solid fa-chevron-left"></i></button>
                                <div class="swiper-dot-2">
                                    <div class="dot"></div>
                                </div>
                                <button class="array-next"><i class="fa-solid fa-chevron-right"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-4 mt-4 mt-xl-0">
                    <div class="movie-sidebar">
                        <div class="single-sidebar-widget">
                            <div class="wid-title">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25" fill="none">
                                    <path d="M6.75 3.5V5.75M17.25 3.5V5.75M3 19.25V8C3 6.75736 4.00736 5.75 5.25 5.75H18.75C19.9926 5.75 21 6.75736 21 8V19.25M3 19.25C3 20.4926 4.00736 21.5 5.25 21.5H18.75C19.9926 21.5 21 20.4926 21 19.25M3 19.25V11.75C3 10.5074 4.00736 9.5 5.25 9.5H18.75C19.9926 9.5 21 10.5074 21 11.75V19.25" stroke="#999999" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <h5> Released Year</h5>
                            </div>
                            <h4 class="date-text">@Model.Year</h4>
                        </div>
                        <div class="single-sidebar-widget">
                            <div class="wid-title">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25" fill="none">
                                    <path d="M10.5 21.5L15.75 10.25L21 21.5M12 18.5H19.5M3 6.12136C4.96557 5.87626 6.96804 5.75 9 5.75M9 5.75C10.1208 5.75 11.2326 5.78841 12.3343 5.864M9 5.75V3.5M12.3343 5.864C11.1763 11.1578 7.68868 15.5801 3 18.0023M12.3343 5.864C13.2298 5.92545 14.1186 6.01146 15 6.12136M10.4113 14.6162C8.78554 12.9619 7.47704 10.9949 6.58432 8.81366" stroke="#999999" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <h5>Available Languages</h5>
                            </div>
                            <ul class="languages-list">
                                @foreach (var language in Model.MovieLanguages)
                                {
                                    <li><a asp-action="detail" asp-route-id="@Model.Id">@language.Language.Name</a></li>
                                }
                            </ul>
                        </div>
                        <div class="single-sidebar-widget">
                            <div class="wid-title">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25" fill="none">
                                    <path d="M11.4807 3.9987C11.6729 3.53673 12.3273 3.53673 12.5195 3.9987L14.6454 9.11016C14.7264 9.30492 14.9096 9.43799 15.1199 9.45485L20.6381 9.89724C21.1369 9.93722 21.3391 10.5596 20.9591 10.8851L16.7548 14.4866C16.5946 14.6238 16.5246 14.8391 16.5736 15.0443L17.858 20.4292C17.9741 20.9159 17.4447 21.3005 17.0177 21.0397L12.2933 18.1541C12.1133 18.0441 11.8869 18.0441 11.7069 18.1541L6.98251 21.0397C6.55551 21.3005 6.02606 20.9159 6.14215 20.4292L7.42664 15.0443C7.47558 14.8391 7.40562 14.6238 7.24543 14.4866L3.04111 10.8851C2.66112 10.5596 2.86335 9.93722 3.36209 9.89724L8.88034 9.45485C9.0906 9.43799 9.27375 9.30492 9.35476 9.11016L11.4807 3.9987Z" stroke="#999999" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <h5>Ratings</h5>
                            </div>
                            <div class="row g-4">
                                <div class="col-lg-6">
                                    <div class="ratting-box">
                                        <h4>IMDb</h4>
                                        <div class="star" >
                                            <i class="fa-solid fa-star"></i>
                                            @ViewBag.Rating
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="single-sidebar-widget">
                            <div class="wid-title">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25" fill="none">
                                    <path d="M3.75 6.5C3.75 5.25736 4.75736 4.25 6 4.25H8.25C9.49264 4.25 10.5 5.25736 10.5 6.5V8.75C10.5 9.99264 9.49264 11 8.25 11H6C4.75736 11 3.75 9.99264 3.75 8.75V6.5Z" stroke="#999999" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                                    <path d="M3.75 16.25C3.75 15.0074 4.75736 14 6 14H8.25C9.49264 14 10.5 15.0074 10.5 16.25V18.5C10.5 19.7426 9.49264 20.75 8.25 20.75H6C4.75736 20.75 3.75 19.7426 3.75 18.5V16.25Z" stroke="#999999" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                                    <path d="M13.5 6.5C13.5 5.25736 14.5074 4.25 15.75 4.25H18C19.2426 4.25 20.25 5.25736 20.25 6.5V8.75C20.25 9.99264 19.2426 11 18 11H15.75C14.5074 11 13.5 9.99264 13.5 8.75V6.5Z" stroke="#999999" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                                    <path d="M13.5 16.25C13.5 15.0074 14.5074 14 15.75 14H18C19.2426 14 20.25 15.0074 20.25 16.25V18.5C20.25 19.7426 19.2426 20.75 18 20.75H15.75C14.5074 20.75 13.5 19.7426 13.5 18.5V16.25Z" stroke="#999999" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <h5>Gernes</h5>
                            </div>
                            <ul class="languages-list">
                                @foreach (var genre in Model.MovieGenres)
                                {
                                    <li><a asp-action="detail" asp-route-id="@Model.Id">@genre.Genre.Name</a></li>
                                }
                            </ul>
                        </div>
                        <div class="single-sidebar-widget">
                            <div class="wid-title">
                                <h5>Director</h5>
                            </div>
                            <div class="post-box-items">
                                <div class="post-img">
                                    <img src="@Model.Directors.Image" style="width:100px; height: 100px;" alt="img">
                                </div>
                                <div class="post-content">
                                    <h5>@Model.Directors.FullName</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
