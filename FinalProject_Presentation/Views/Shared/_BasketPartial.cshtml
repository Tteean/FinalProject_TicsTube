@using FinalProject_Service.Dto.BasketDtos
@model List<BasketItemDto>

    <div class="offcanvas__info">
        <div class="offcanvas__wrapper">
            <div class="offcanvas__content">
                <div class="offcanvas__top mb-5 d-flex justify-content-between align-items-center">
                    <div class="offcanvas__logo">
                        <a asp-controller="home" asp-action="index">
                            <img src="~/assets/img/logo/white-logo.svg" alt="logo-img">
                        </a>
                    </div>
                    <div class="offcanvas__close">
                        <button>
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                
                <div class="mobile-menu fix mb-5"></div>
                @foreach (var product in Model)
                {
                    <div id="basketContainer" class="minicart-item-wrapper">
                        <ul>
                            <li class="minicart-item">
                                <div class="minicart-thumb">
                                    <a href="product-details.html">
                                        <img src="~/assets/img/product/@product.Image" alt="" />
                                    </a>
                                </div>
                                <div class="minicart-content">
                                    <h3 class="product-name">
                                        <a asp-controller="product" asp-action="detail" asp-route-id="@product.Id">@product.Name</a>
                                    </h3>
                                    <p>
                                        <span class="cart-quantity">@product.Count <strong>&times;</strong></span>
                                        <span class="cart-price">$@((product.Count * product.Price).ToString("0.##"))</span>
                                    </p>
                                </div>
                                <button class="minicart-remove">
                                    <a onclick="removeItem(@product.Id)">
                                        <i class="ion-android-close"></i>
                                    </a>
                                </button>
                            </li>
                        </ul>
                    </div>

                }

            </div>
        </div>
    </div>

<div class="minicart-button">
    <a asp-controller="basket" asp-action="index"><i class="fa fa-shopping-cart"></i> view cart</a>
    <a asp-controller="basket" asp-action="checkout"><i class="fa fa-share"></i> checkout</a>
</div>

<script>
    document.querySelector(".BasketItemCount").innerHTML=@Model.Count
</script>

<script>
    function removeItem(id) {
    fetch("/Basket/RemoveItem?id=${id}")
        .then(response => response.text())
        .then(html => {
            document.getElementById("basketContainer").innerHTML = html;
        });
    }
</script>